<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Markov Chain Text Playground</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea, input[type="range"], input[type="number"] { width: 100%; margin-bottom: 10px; }
    #output { white-space: pre-wrap; background: #f0f0f0; padding: 10px; border: 1px solid #ccc; }
    .flex-row { display: flex; gap: 10px; align-items: center; }
    .flex-row input[type="number"] { width: 100%; max-width: 150px; }
    label span { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Markov Chain Text Playground</h1>

  <label for="inputText">Input Text:</label>
  <textarea id="inputText" rows="10" placeholder="Paste your text here..."></textarea>

  <label for="order">Order: <span id="orderValue">1</span></label>
  <input type="range" id="order" min="1" max="8" value="1" />

  <label for="length">Output Length (words): <span id="lengthValue">100</span></label>
  <input type="range" id="length" min="1" max="1000" value="100" />

  <label>Seed:</label>
  <div class="flex-row">
    <input type="range" id="seed" min="0" max="1000" value="42" />
    <input type="number" id="seedBox" min="0" max="4294967295" value="180000000" />
  </div>

  <label for="seedBox">Seed Value: <span id="seedValue">42</span></label>

  <h2>Generated Text:</h2>
  <div id="output"></div>

  <script>
    function mulberry32(seed) {
      return function() {
        let t = (seed += 0x6D2B79F5);
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    function buildMarkovChain(text, order) {
      const chain = {};
      for (let i = 0; i < text.length - order; i++) {
        const key = text.substring(i, i + order);
        const next = text.charAt(i + order);
        if (!chain[key]) chain[key] = [];
        chain[key].push(next);
      }
      return chain;
    }

    function generateFromChain(chain, order, wordCount = 100, seed = 42) {
      const keys = Object.keys(chain);
      if (keys.length === 0) return "";

      const rand = mulberry32(seed);
      let key = keys[Math.floor(rand() * keys.length)];
      let result = key;
      let wordCounter = key.trim().split(/\s+/).length;

      while (wordCounter < wordCount) {
        const nextChars = chain[key];
        if (!nextChars) {
          key = keys[Math.floor(rand() * keys.length)];
          result += ' ';
          continue;
        }

        const nextChar = nextChars[Math.floor(rand() * nextChars.length)];
        result += nextChar;
        key = result.slice(-order);
        wordCounter = result.trim().split(/\s+/).length;
      }

      return result;
    }

    function generateText() {
      const text = document.getElementById('inputText').value;
      const order = parseInt(document.getElementById('order').value, 10);
      const length = parseInt(document.getElementById('length').value, 10);
      const seed = parseInt(document.getElementById('seedBox').value, 10);

      if (!text || isNaN(order) || isNaN(length) || isNaN(seed)) return;

      document.getElementById('seedValue').textContent = seed;

      const chain = buildMarkovChain(text, order);
      const generated = generateFromChain(chain, order, length, seed);
      document.getElementById('output').textContent = generated;
    }

    const inputText = document.getElementById('inputText');
    const orderSlider = document.getElementById('order');
    const orderValue = document.getElementById('orderValue');
    const lengthSlider = document.getElementById('length');
    const lengthValue = document.getElementById('lengthValue');
    const seedSlider = document.getElementById('seed');
    const seedBox = document.getElementById('seedBox');

    orderSlider.addEventListener('input', () => {
      orderValue.textContent = orderSlider.value;
      generateText();
    });

    lengthSlider.addEventListener('input', () => {
      lengthValue.textContent = lengthSlider.value;
      generateText();
    });

    inputText.addEventListener('input', generateText);

    seedSlider.addEventListener('input', () => {
      const scaled = Math.floor(seedSlider.value * 4294967.295); // scale 0â€“1000 to 32-bit range
      seedBox.value = scaled;
      document.getElementById('seedValue').textContent = scaled;
      generateText();
    });

    seedBox.addEventListener('input', () => {
      let val = parseInt(seedBox.value, 10);
      if (isNaN(val)) val = 0;
      if (val > 4294967295) val = 4294967295;
      seedSlider.value = Math.floor(val / 4294967.295);
      document.getElementById('seedValue').textContent = val;
      generateText();
    });
  </script>
</body>
</html>
